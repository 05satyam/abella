#UPLOAD_SITE = "agacek@bhoop.cs.umn.edu:/project/gopalan/abella"
UPLOAD_SITE = "agacek@bhoop.cs.umn.edu:/home/grad01/agacek/.www/abella"

VERSION = 1.0tester

.SUBDIRS: src examples

################################################
# Distribution
#

BuildDist() =
    rm -rf dist

    mkdir dist
    cp dist-makefile dist/makefile
    cp README dist/README
    cp COPYING dist/COPYING
    cp CHANGELOG dist/CHANGELOG

    mkdir dist/src
    cp src/*.ml* dist/src
    rm dist/src/*test*.ml
    rm dist/src/parser.mli
    rm dist/src/parser.ml
    rm dist/src/lexer.ml

    mkdir dist/examples
    cp examples/*.mod dist/examples
    cp examples/*.thm dist/examples

    mkdir dist/emacs
    cp emacs/* dist/emacs

.PHONY: dist
dist: test theorems
    BuildDist()
    make -C dist
    BuildDist()
    rm -f abella.tar.gz
    mv dist abella
    tar c abella | gzip - > abella.tar.gz
    rm -rf abella

.PHONY: dist-windows
dist-windows: test theorems
    BuildDist()
    make -C dist
    mv dist/abella.exe .
    BuildDist()
    mv abella.exe dist/
    rm -f abella.zip
    mv dist abella
    zip -r abella.zip abella
    rm -rf abella

version.html:
    fprint(version.html, $(VERSION))

.PHONY: upload
upload: dist dist-windows version.html
    scp abella.zip abella.tar.gz version.html $(UPLOAD_SITE)

